{Syst/testpaa.i}
Syst.CUICommon:katun = "anttis".
{Func/barrfunc.i}
DEFINE VARIABLE lcCLis AS CHARACTER NO-UNDO. 

lcClis = "600250352 605031824 606848776 607227148 609748831 610704067 615204118 617224906 617504234 618354604 618572250 618603141 622010043 622010528 622027763 622032094 622058146 622068373 622084638 622092096 622095485 622101643 622102362 622102846 622105678 622115961 622154849 622223570 622243110 622245872 622257644 622270490 622292920 622296633 622346112 622360601 622383834 622412199 622423911 622429882 622438358 622555095 622596038 622621418 622645346 622666385 622677915 622678136 622679633 622682988 622684970 622685608 622734539 622778971 622867977 622879746 622885400 625979794 626942298 628206764 633102904 633129124 633145868 633175971 633203339 633224749 633232871 633234981 633236277 633245652 633260379 633261340 633263046 633263899 633270549 633270609 633274229 633281870 633283811 633297833 633340186 633340246 633340475 633341453 633347255 633353518 635139449 635935875 635970867 637127102 645138327 645235589 646577978 647412663 647797108 648263949 648849846 649166177 649692191 651165695 652386047 652850685 652908473 653060843 653930651 654756405 654765393 656266743 657133655 657555136 657649930 658870417 659137316 660230646 660326574 660815541 662489538 664876107 665202995 665648980 666151451 666670635 666891178 669419299 670373875 670643048 670700768 671451247 671643492 675057206 675529602 676204222 676269000 676308150 677449048 685555641 685565473 686143429 689038263 690357791 691522271 691781331 695819185 697906014 699215246".

DEFINE VARIABLE i AS INTEGER NO-UNDO. 
DEFINE VARIABLE lcCli AS CHARACTER NO-UNDO. 

def stream slog.
output stream slog to /apps/snet/200908/as_ydr9_unbarr.log append.

DEFINE VARIABLE lcBarrStatus AS CHARACTER NO-UNDO. 
DEFINE VARIABLE lrBarring as rowid no-undo.
DEFINE VARIABLE lcResult AS CHARACTER NO-UNDO. 

do i = 1 to num-entries(lcCLis, " "):
   lcCLi = entry(i, lcCLis, " ").
   if i <= 1 then next.
   find mobsub where
      mobsub.cli = lcCli  NO-LOCK NO-ERROR.
   if not avail mobsub then do:
      put stream slog unformatted lcCli " not found" skip.
      next.
   end.
   lcBarrStatus = fCheckBarrStatus(mobsub.msseq, output lrBarring).
   if lcBarrStatus = "OK" then do:
      put stream slog mobsub.cli " " lcBarrStatus skip.
      next.
   end.  
   else if lcBarrStatus = "D_REST" then do:
   /* create barring request */
     RUN Mm/barrengine.p (mobsub.MsSeq,
                     "UN" + lcBarrStatus,
                     "5",           /* source  */
                     "YDR-8",       /* creator */
                     Func.Common:mMakeTS() + 0.0012, /* activate, 2min delay */
                     "",                 /* SMS */
                     OUTPUT lcResult).
      put stream slog mobsub.cli " " lcBarrStatus " " lcResult skip.
   end.
   else put stream slog mobsub.cli " " lcBarrStatus " error" skip.
end.
