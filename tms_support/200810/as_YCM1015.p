DEFINE VARIABLE sep AS CHARACTER NO-UNDO. 
sep = chr(255).

DEFINE VARIABLE liOrderId AS INTEGER NO-UNDO. 
DEFINE VARIABLE orders AS CHARACTER NO-UNDO. 
orders = "211369 252977 256912 265344 265857 269886 271401 272051 273743 274443 274810 275748 276017 276283 276469 276678 277441 277565 277918 278441 278818 279093 279139 279606 279700 279758 279836 279965 279979 280119 280163 280453 280471 280995 281099 281114 281310 281314 281347 281354 281370 281515 281573 281638 281729 281777 281862 281882 282030 282041 282125 282132 282212 282261 282384 282402 282464 282479 282626 282650 282668 282761 282764 282779 282789 282836 282841 282847 282937 282964 282988 283059 283062 283097 283130 283267 283298 283309 283343 283417 283544 283571 283582 283609 283615 283684 283693 283735 283739 283752 283840 283858 283877 284160 284276 284311 284461 284504 284807 284928 285329 285392 285467 285511 285512 285518 285575 285651 285752 285907 286118 286170 286202 286355 286357 286401 286481 286570 286745 286780 286888 286908 287054 287084 287138 287163 287184 287256 287371 287565 287571 287598 287647 287774 287859 287912 287948 288041 288123 288176 288180 288377 288537 288551 288555 288566 288591 288601 288618 288678 288720 288804 288822 288912 288919 288950 288961 289056 289156 289192 289233 289255 289279 289322 289337 289352 289427 289432 289478 289485 289580 289597 289689 289747 289761 289796 289908 290083 290110 290119 290135 290142 290201 290246 290254 290287 290291 290304 290374 290439 290440 290442 290450 290489 290491 290525 290591 290716 290762 290808 290870 290893 290906 290914 290990 291144 291164 291172 291198 291226 291257 291259 291277 291291 291302 291311 291353 291372 291440 291460 291621 291638 291674 291698 291749 291755 291766 291789 291813 291915 291960 291989 291995 292086 292092 292120 292159 292183 292184 292185 292304 292318 292366 292381 292448 292502 292515 292519 292538 292539 292652 292686 292756 292792 292795 292812 292848 292875 292890 292895 292929 292977 293038 293050 293082 293094 293115 293160 293187 293191 293192 293202 293213 293218 293234 293249 293284 293288 293291 293295 293335 293342 293350 293354 293379 293386 293388 293412 293414 293453 293463 293467 293487 293493 293505 293511 293530 293542 293547 293572 293585 293660 293672 293733 293771 293777 293903 293904 293911 293913 293918 293920 293947 293953 293956 293976 294013 294028 294065 294086 294092 294096 294100 294105 294114 294194 294197 294200 294208 294246 294340 294409 294454 294669 294824 294990 295105 295110 295297 295429 295430 295546 295798 295810 295859 295873 295971 295994 296105 296106 296144 296338 296373 296473 296566 296619 296646 296696 296736 296740 296807 296891 296961 296986 297013 297070 297100 297154 297184 297201 297266 297272 297310 297341 297416 297461 297469 297489 297497 297513 297515 297548 297653 297667 297740 297758 297921 297923 297937 297987 297992 298004 298020 298022 298034 298058 298108 298117 298121 298192 298202 298239 298358 298359 298373 298404 298554 298633 298718 298719 298721 298742 298788 298833 298854 298911 298954 298959 298998 299004 299010 299023 299038 299039 299055 299075 299092 299137 299138 299146 299170 299171 299182 299187 299188 299205 299208 299278 299279 299286 299336 299338 299341 299343 299356 299366 299407 299416 299459 299575 299576 299584 299606 299640 299724 299796 299850 299857 300005 300022 300025 300069 300102 300103 300131 300144 300179 300219 300220 300229 300259 300296 300308 300330 300382 300416 300419 300469 300497 300502 300514 300527 300574 300582 300610 300644 300649 300651 300658 300748 300792 300796 300817 300825 300833 300942 300995 301018 301019 301021 301023 301024 301039 301041 301042 301043 301044 301046 301060 301080 301115 301129 301181 301185 301188 301224 301240 301247 301248 301259 301342 301343 301392 301406 301408 301417 301481 301492 301501 301522 301533 301536 301543 301577 301601 301640 301727 301771 301778 301899 301916 301964 301965 301997 301998 302069 302123 302138 302144 302220 302250 302362 302439 302495 302501 302518 302523 302525 302545 302550 302553 302566 302567 302573 302637 302639 302641 302662 302666 302923 302976 302980 303014 303018 303079 303110 303126 303132 303197 303261 303291 303373 303380 303418 303431 303532 303554 303557 303559 303630 303636 303728 303753 303755 303807 303810 303824 303836 303875 303878 303879 303883 303884 303941 304109 304116 304250 304326 304409 304411 304439 304442 304445 304452 304499 304606 304667 304719 304757 304759 304798 304865 304908 304934 304965 305014 305066 305073 305163 305194 305239 305256 305261 305274 305286 305332 305474 305501 305513 305530 305557 305615 305616 305622 305626 305628 305646 305650 305661 305668 305671 305692 305785 305787 305790 305863 305868 305896 305904 305912 305937 305949 305955 305993 306019 306029 306053 306055 306060 306109 306164 306168 306169 306176 306181 306201 306203 306210 306216 306220 306222 306241 306283 306317 306324 306333 306379 306385 306389 306392 306396 306403 306426 306451 306463 306478 306494 306563 306580 306588 306593 306638 306663 306685 306735 306777 306778 306803 306830 306889 306900 306933 306998 307074 307157 307163 307264 307320 307430 307600 307627 307784 308284 308528 308572 308607 308608 308641 308673 308678 308701 308725 308736 308740 308762 308785 308846 308848 308849 308855 308867 308876 308940 308961 308962 308988 309005 309007 309065 309069 309554 309699 309751 309773 310129 310182 310302 310375 310438 310499 310501 310689 310799 310812 310813 310816 310836 310870 310907 310911 310913 310957 311227 311864 311865 311932 311961 311966 312028 312111 312358 312404 312603 312985 313174 313194 313199 314226 314429 314594 314615 314617 314747 315828 316232 316589 317203 318302 318309".
DEFINE VARIABLE lcKey AS CHARACTER NO-UNDO. 

DEFINE VARIABLE k AS INTEGER NO-UNDO. 
DEFINE VARIABLE liOrder AS INTEGER NO-UNDO. 

def stream sout.
output stream sout to /home/anttis/orderaccessory.txt.

DO k = 1 to num-entries(orders, " "):

   liOrder = INT(entry(k, orders, " ")).

   lcKey = "1" + sep + string(liOrder).
   disp lcKey.
   DEFINE VARIABLE i AS INTEGER NO-UNDO.


   DEFINE VARIABLE j AS INTEGER NO-UNDO. 

   FIND FIRST order where order.brand = "1" and
    orderid = liOrder NO-LOCK NO-ERROR.

   FOR EACH eventlog where
      eventlog.tablename = "orderaccessory" and
      eventlog.key eq lcKey NO-LOCK.
   
   do i = 1 to num-entries(eventlog.modifiedfields,","):
     j = index(eventlog.datavalues,entry(i,eventlog.modifiedfields,",")).
     put stream sout unformatted
         string(liorder) ":" order.orderchannel ":" entry(2,substring(eventlog.datavalues,j),chr(255)) ":" entry(3,substring(eventlog.datavalues,j),chr(255)) skip.
      FIND FIRST orderaccessory of order EXCLUSIVE-LOCK NO-ERROR.
      ASSIGN orderaccessory.imei = entry(2,substring(eventlog.datavalues,j),chr(255)).
      /*string(liorder)":"order.orderchannel":"entry(i,eventlog.modifiedfields,",")" = " entry(2,substring(eventlog.datavalues,j),chr(255)) */
   end.
   end.
end.
output stream sout close. 


output stream sout to /home/anttis/orderdelivery.d.

DO k = 1 to num-entries(orders, " "):

   liOrder = INT(entry(k, orders, " ")).

   FOR EACH orderdelivery where orderdelivery.brand = "1" and
     orderdelivery.orderid = liOrder EXCLUSIVE-LOCK:
    export stream sout orderdelivery.
    delete orderdelivery.
   end.
end.

output stream sout close. 
